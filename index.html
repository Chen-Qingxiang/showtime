<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>一页版时间轴 · MVP（CSV 两列即可）</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="bar">
      <label><span class="pill">步骤 1</span>CSV 文件（两列：time,title；layer 取自文件名）：</label>
      <input id="file" type="file" accept=".csv,text/csv" />
      <button id="btn-load">加载左侧文本</button>
      <div style="flex:1"></div>
      <label><span class="pill">步骤 2</span>滚轮缩放 / 拖拽平移</label>
      <label>缩放：<input id="zoomSlider" type="range" min="0.01" max="1000" step="0.01" value="1"></label>
      <button id="btn-reset">重置视图</button>
    </div>
  </header>

  <div class="wrap">
    <aside class="side">
      <h3>CSV 文本（示例）</h3>
      <textarea id="csvText" spellcheck="false"># time,title（两列；layer 由文件名决定，左侧文本默认层名“文本”）
# 约定：范围用 ~ 分隔；可用负数表示 BCE（例 -2070~-1600）
# 若无结束（例如 1949~），将自动以“当前年”代替
-2070~-1600,夏
-1600~-1046,商
-1046~-256,周
-221~-207,秦
-202~8,西汉
9~23,新
25~220,东汉
220~266,魏
221~263,蜀汉
222~280,吴
266~316,西晋
317~420,东晋
420~589,南北朝
581~618,隋
618~907,唐
690~705,武周
907~960,五代
907~979,十国
916~1125,辽
960~1127,北宋
1127~1279,南宋
1038~1227,西夏
1115~1234,金
1271~1368,元
1368~1644,明
1636~1912,清
1912~1949,中华民国（大陆时期）
1949~,中华人民共和国</textarea>
      <div class="hint small">
        <div>时间字段格式：</div>
        <ul>
          <li><code>start~end</code>（分隔符可用 <b>~ - — – － 〜 ～ 至 到</b>；支持负数或 221BC/公元前221）</li>
          <li>单点也可：<code>1054</code> 会被视为 <code>1054~1054</code></li>
          <li>文件上传时 <code>layer</code> 取自文件名；“加载左侧文本”默认归为 <code>文本</code> 层</li>
        </ul>
        <div>操作：<span class="kbd">滚轮</span> 缩放，<span class="kbd">拖拽</span> 平移；<span class="kbd">Shift + 滚轮</span> 围绕中心缩放；<span class="kbd">Ctrl/Cmd + 滚轮</span> 加速缩放；<b>在左侧图层名称区域按住拖动</b>可上下调整 layer 顺序；<span class="kbd">右键</span> 图层名称可删除该层；双击或“重置视图”复位。</div>
      </div>
    </aside>
    <main>
      <canvas id="c"></canvas>
    </main>
  </div>

  <div id="testBadge" title="点击查看自测详情" style="display:none"></div>
  <div id="testPanel">
    <h4>自测结果</h4>
    <pre id="testLog"></pre>
  </div>
  <div id="layerMenu">
    <h5>图层操作</h5>
    <button id="menuDelete" class="danger">🗑 删除该层</button>
    <button id="menuCancel">取消</button>
  </div>
  <div id="toast"></div>

  <script defer src="app.js"></script>
</body>
</html>
